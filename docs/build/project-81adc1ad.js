function a(a){const e=localStorage.getItem(a);return JSON.parse(e)}function e(){if(!localStorage.length)return[];return[...Array(localStorage.length)].map(((a,e)=>localStorage.key(e)))}function t(a,e){localStorage.setItem(a,JSON.stringify(e))}const s={ano:"",images:[],materia:"",nAlternativas:4,nQuestoes:5,text:""};class i{constructor(a,e,t){this.name=a,this.data=e,this.imagesUrls=t}static async create(a,e){e||(e=s);const t=await Promise.all(e.images.map((async({id:a,data:e})=>{const t=await fetch(e),s=await t.blob();return{id:a,url:URL.createObjectURL(s)}})));return new i(a,e,t)}dispose(){this.imagesUrls.forEach((a=>URL.revokeObjectURL(a.url)))}async setImage(a,e=""){const t=e;if(e||(e=this.getName(e)),!e)return!1;t&&this.removeImage(t);const s=await this.toDataURL(a);return this.data.images.push({id:e,data:s}),this.imagesUrls.push({id:e,url:URL.createObjectURL(a)}),!0}renameImage(a){const e=e=>e.id==a,t=this.getName(a);return!!t&&(this.data.images.find(e).id=t,this.imagesUrls.find(e).id=t,!0)}getName(a){do{const e=this.imagesUrls.some((e=>e.id==a))?"Escolha uma identificação diferente para a imagem.":"Escolha a identificação da imagem.";if(!(a=prompt(e,a)))break}while(this.imagesUrls.some((e=>e.id==a)));return a&&(a=a.replaceAll(" ","-")),a}save(){t(this.name,this.data)}async copyImage(a){if(!(a=this.getName(a)))return"";const e=e=>e.id==a,t=this.imagesUrls.find(e);this.imagesUrls.push(Object.assign(Object.assign({},t),{id:a}));const s=this.data.images.find(e);return this.data.images.push(Object.assign(Object.assign({},s),{id:a})),a}removeImage(a){const e=e=>e.id==a,t=this.imagesUrls.findIndex(e);URL.revokeObjectURL(this.imagesUrls[t].url),this.imagesUrls.splice(t,1);const s=this.data.images.findIndex(e);this.data.images.splice(s,1)}async toDataURL(a){return await new Promise(((e,t)=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=t,s.readAsDataURL(a)}))}}export{i as P,e as a,s as d,a as g,t as s};
